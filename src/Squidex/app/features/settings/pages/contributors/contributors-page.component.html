<sqx-title message="{app} | Contributors | Settings" parameter1="app" [value1]="appsState.appName"></sqx-title>

<sqx-panel desiredWidth="50rem">
    <ng-container title>
        Contributors
    </ng-container>

    <ng-container content>
		<div class="panel-alert panel-alert-success" *ngIf="maxContributors > 0">
			Your plan allows up to {{maxContributors}} contributors.
		</div>
		
		<table class="table table-items table-fixed">
			<tbody>
				<ng-template ngFor let-contributor [ngForOf]="appContributors?.contributors">
					<tr>
						<td class="cell-user">
							<img class="user-picture" [attr.title]="contributor.contributorId | sqxUserName" [attr.src]="contributor.contributorId | sqxUserPicture" />
						</td>
						<td class="cell-auto">
							<span class="user-name table-cell">{{contributor.contributorId | sqxUserName}}</span>
						</td>
						<td class="cell-time">
							<select class="form-control" [ngModel]="contributor.permission" (ngModelChange)="changePermission(contributor, $event)" [disabled]="userId === contributor.contributorId">
								<option *ngFor="let permission of usersPermissions" [ngValue]="permission">{{permission}}</option>
							</select>
						</td>
						<td class="cell-actions">
							<button *ngIf="ctx.userId !== contributor.contributorId" type="button" class="btn btn-link btn-danger" (click)="removeContributor(contributor)">
								<i class="icon-bin2"></i>
							</button>
						</td>
					</tr>
					<tr class="spacer"></tr>
				</ng-template>
			</tbody>
		</table>
		
		<div class="table-items-footer" *ngIf="appContributors">
			<form [formGroup]="addContributorForm" (ngSubmit)="assignContributor()">
				<div class="row no-gutters">
					<div class="col">
						<sqx-autocomplete [source]="usersDataSource" formControlName="user" [inputName]="'contributor'" placeholder="Find existing user" displayProperty="displayName">
							<ng-template let-user="$implicit">
								<span class="autocomplete-user">
									<img class="user-picture autocomplete-user-picture" [attr.src]="user | sqxUserDtoPicture" />

									<span class="user-name autocomplete-user-name">{{user.displayName}}</span>
								</span>
							</ng-template>
						</sqx-autocomplete>
					</div>
					<div class="col col-auto pl-1">
						<button type="submit" class="btn btn-success" [disabled]="!canAddContributor">Add Contributor</button>
					</div>
                </div>
            </form>
        </div>
    </ng-container>
</sqx-panel>